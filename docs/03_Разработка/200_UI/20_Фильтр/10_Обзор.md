# Обзор компонента

[TOC]

Системный компонент `bitrix:main.ui.filter` обеспечивает отображение фильтра на странице и отвечает за визуальную часть блока "фильтр + поиск".
Для более углубленного изучения, его можно найти в директории `bitrix/components/bitrix/main.ui.filter/` вашего проекта.

Немного терминологии:
- Фильтром в контексте этой статьи называется весь компонент обеспечивающий работу фильтрации.
- Поле - это выведенные в компоненте фильтра управляющие элементы, обеспечивающие фильтрации по какому-либо признаку
- Пресет - именованная группировка полей фильтра, которая может содержать предустановленные значения
- Конфигурация поля - мета-информация о поле, описывает тип, обязательность, множественность и т.п.

## Параметры компонента

| Параметр | Описание |
| :--- | --- |
| `FILTER_ID` (string) | - уникальный идентификатор фильтра, используемый для отделения его от других фильтров в продукте. Единственный обязательный параметр компонента. |
| `GRID_ID` (string) | - опциональный параметр идентификатор связанного грида. Если заполнен, то некоторые действия грида и фильтра будут связаны. Например при применении фильтра грид будет автоматически обновлен. |
| `FIELDS` (array) | - набор полей для фильтра. Подробнее в главе "Поля фильтра" |
| `RENDER_FILTER_INTO_VIEW` (string) | - код включаемой области для отрисовки фильтра |
| `RENDER_FILTER_INTO_VIEW_SORT` (int) | - приоритет для отрисовки в включаемой области (по-умолчанию 500) |
| `SETTINGS_URL` (string) | - относительный url к файлу, который управляет настройками фильтра. По-умолчанию ссылается на файл `settings.ajax.php` в папке компонента |
| `FILTER_ROWS` (array) | - набор идентификаторов полей фильтра находящихся на странице при первоначальной отрисовке (поля по-умолчанию или поля из последнего пресета) |
| `CURRENT_PRESET` (string) | - пресет из набора, переданного в параметрах `FILTER_PRESETS`, который выбран при открытии. |
| `ENABLE_LABEL` (bool) | - флаг, отвечающий за вывод названий полей в фильтре. |
| `DISABLE_SEARCH` (bool) | - в случае `true` будет доступен только фильтр без поиска. Семантически  похож на `ENABLE_LIVE_SEARCH`, поэтому последний не рассматривается |
| `LIMITS` (array) | - ассоциативный массив описываюший предупреждение с лимитами. Подробнее в главе "Лимиты" |
| `RESET_TO_DEFAULT_MODE` (bool) | - флаг, отвечающий за поведение ворзвращения фильтра на закрепленный пресет. В случае когда пользователь имеет закрепленный пресет, затем выбирает другой фильтр и отменяет его, то в случае `true` (по-умолчанию) фильтр вернется в закрепленный пресен |
| `LAZY_LOAD` (array) | - массив ссылок, отвечающий за ленивую подгрузку данных |
| `MESSAGES` (array) |- массив языковых фраз для переопределения. Подробнее в главе "Переопределение языковых фраз фильтра" |
|`FILTER` (array) | - набор конфигураций полей фильтра. |
| `FILTER_ROWS` (array) | - опциональный параметр показывающий какие поля из `FILTER` сейчас находятся на форме. Если не передан - будет вычислен из полей `FILTER` и пресета пользователя. По сути ассоциативный массив `<k> => <v>`, где `k` - код поля, а `v` - bool-значение, `true` если отображается |
| `FILTER_PRESETS` (array) | - набор пресетов, отображающихся у пользователей как системные (их нельзя удалить). В фильтре всегда есть пресет с кодом `default_filter`, добавлять его самому не нужно, но и переопределять его не имеет смысла - он будет добавален автоматически компонентом. |
| `COMMON_PRESETS_ID` (string) | - пресет из списка `FILTER_PRESETS`, являющийся основным (т.е. по-умолчанию) при открытии страницы. |
| `CONFIG` (array) | - массив дополнительной приоритетной информации относительно конфигурации пользователя. Подробнее он разобран в "Поведение ключа `CONFIG`". |
| `VALUE_REQUIRED` (bool) | - нужно ли контролировать в фильтре обязательные параметры. В случае если параметр `true`, будет выполнен поиск обязательных полей и принудительный вывод на выбранный экран. Обязательные поля нельзя будет удалить из отображения фильтра. |
| `VALUE_REQUIRED_MODE` (bool) | Дополнительный флаг меняющий поведение фильтра без параметров. Дополняет стандартное поведение `VALUE_REQUIRED`. |
| `THEME` | - идентификатор темы применяемой для фильтра. Подробнее в главе "Темы для фильтра" |

### Отображаемый вид открытого фильтра

![Отображаемый вид открытого фильтра](images/displayed_filter.png)

### Изменение фильтра через `apply_filter` и POST-запрос

Существует возможность задавать заранее выбранные значения через query string (GET) параметры страницы, при условии `POST` запроса к странице.
При открытии страницы, проверяется наличие POST-параметра `apply_filter` и если там находится `Y`, происходит замена пользовательского фильтра переданного в GET-параметре `filter_id` на значения переданные при отправке запроса (читается как GET, так и POST параметры - порядок - сначала GET, потом POST накладываются друг на друга заменяя).


### Поведение ключа `CONFIG`


## Поля фильтра


## Темы для фильтра

Компонент поддерживает возможность применения тем. Тема - это визуальный стил фильтра, который применяется поверх стандартного отображения.
Набор тем ограничен стандартными темами.

За работу тем отвечает класс `Bitrix\Main\UI\Filter\Theme`, который имеет константы тем и единственный метод `getList()` который возвращает список всех доступных тем (констант класса).

Доступные темы:

- По-умолчанию (`Theme::DEFAULT_FILTER`)
- Обрамленная (`Theme::BORDER`) - отличие от по-умолчанию в блоке фильтрации добавлена линии сверху и снизу от фильтра
- Округленная (`Theme::ROUNDED`) - левый и правый клая в блоке фильтрации сильно скруглены
- Легкая (`Theme::LIGHT`) - у фильтра белый фон заменен на полупрозрачный серый
- Приглушенная (`Theme::MUTED`) - текст в фильтре не броский, становится более контрастным при наведении 

## Переопределение языковых фраз фильтра


		$this->arResult["MAIN_UI_FILTER__AND"] = Loc::getMessage('MAIN_UI_FILTER__AND');
		$this->arResult["MAIN_UI_FILTER__MORE"] = Loc::getMessage('MAIN_UI_FILTER__MORE');
		$this->arResult["MAIN_UI_FILTER__BEFORE"] = Loc::getMessage("MAIN_UI_FILTER__BEFORE");
		$this->arResult["MAIN_UI_FILTER__AFTER"] = Loc::getMessage("MAIN_UI_FILTER__AFTER");
		$this->arResult["MAIN_UI_FILTER__NUMBER_MORE"] = Loc::getMessage("MAIN_UI_FILTER__NUMBER_MORE");
		$this->arResult["MAIN_UI_FILTER__NUMBER_LESS"] = Loc::getMessage("MAIN_UI_FILTER__NUMBER_LESS");
		$this->arResult["MAIN_UI_FILTER__PLACEHOLDER_DEFAULT"] = Loc::getMessage("MAIN_UI_FILTER__PLACEHOLDER_DEFAULT");
		$this->arResult["MAIN_UI_FILTER__PLACEHOLDER_WITH_FILTER"] = Loc::getMessage("MAIN_UI_FILTER__PLACEHOLDER_WITH_FILTER");
		$this->arResult["MAIN_UI_FILTER__PLACEHOLDER"] = Loc::getMessage("MAIN_UI_FILTER__PLACEHOLDER");
		$this->arResult["MAIN_UI_FILTER__PLACEHOLDER_LIMITS_EXCEEDED"] = Loc::getMessage("MAIN_UI_FILTER__PLACEHOLDER_LIMITS_EXCEEDED");
		$this->arResult["MAIN_UI_FILTER__QUARTER"] = Loc::getMessage("MAIN_UI_FILTER__QUARTER");
		$this->arResult["MAIN_UI_FILTER__IS_SET_AS_DEFAULT_PRESET"] = Loc::getMessage("MAIN_UI_FILTER__IS_SET_AS_DEFAULT_PRESET");
		$this->arResult["MAIN_UI_FILTER__SET_AS_DEFAULT_PRESET"] = Loc::getMessage("MAIN_UI_FILTER__SET_AS_DEFAULT_PRESET");
		$this->arResult["MAIN_UI_FILTER__EDIT_PRESET_TITLE"] = Loc::getMessage("MAIN_UI_FILTER__EDIT_PRESET_TITLE");
		$this->arResult["MAIN_UI_FILTER__REMOVE_PRESET"] = Loc::getMessage("MAIN_UI_FILTER__REMOVE_PRESET");
		$this->arResult["MAIN_UI_FILTER__DRAG_TITLE"] = Loc::getMessage("MAIN_UI_FILTER__DRAG_TITLE");
		$this->arResult["MAIN_UI_FILTER__DRAG_FIELD_TITLE"] = Loc::getMessage("MAIN_UI_FILTER__DRAG_FIELD_TITLE");
		$this->arResult["MAIN_UI_FILTER__REMOVE_FIELD"] = Loc::getMessage("MAIN_UI_FILTER__REMOVE_FIELD");
		$this->arResult["MAIN_UI_FILTER__CONFIRM_MESSAGE_FOR_ALL"] = Loc::getMessage("MAIN_UI_FILTER__CONFIRM_MESSAGE_FOR_ALL");
		$this->arResult["MAIN_UI_FILTER__CONFIRM_APPLY_FOR_ALL"] = Loc::getMessage("MAIN_UI_FILTER__CONFIRM_APPLY_FOR_ALL");
		$this->arResult["MAIN_UI_FILTER__DATE_NEXT_DAYS_LABEL"] = Loc::getMessage("MAIN_UI_FILTER__DATE_NEXT_DAYS_LABEL");
		$this->arResult["MAIN_UI_FILTER__DATE_PREV_DAYS_LABEL"] = Loc::getMessage("MAIN_UI_FILTER__DATE_PREV_DAYS_LABEL");
		$this->arResult["MAIN_UI_FILTER__DATE_ERROR_TITLE"] = Loc::getMessage("MAIN_UI_FILTER__DATE_ERROR_TITLE");
		$this->arResult["MAIN_UI_FILTER__DATE_ERROR_LABEL"] = Loc::getMessage("MAIN_UI_FILTER__DATE_ERROR_LABEL");
		$this->arResult["MAIN_UI_FILTER__VALUE_REQUIRED"] = Loc::getMessage("MAIN_UI_FILTER__VALUE_REQUIRED");


## Лимиты

```php
'LIMITS' => [
	"TITLE" => "Title",
	"DESCRIPTION" => "Description text",
	"BUTTONS" => [
		"<button>Some button</button>"
	]
],
```

![Отображение сообщения о лимитах](images/displayed_limits.png)
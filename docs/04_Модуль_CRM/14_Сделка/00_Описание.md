# Описание сущности

Сделка - один из основных элементов CRM, это процесс продажи товара или услуги клиенту.

>Перечень полей может изменяться и в зависимости от метода и способа вызова иметь различные аттрибуты. Конкретный перечень доступных полей необходимо смотреть в исходном коде метода который используется.

# Поля

| Поле                  | Тип          | Описание                                                                                             | Примечание                         |
|:----------------------|--------------|------------------------------------------------------------------------------------------------------|------------------------------------|
| ID                    | int          | Уникальный целочисленный идентификатор                                                               | ``AI``, ``RO``                     |
| TITLE                 | string       | Название сделки                                                                                      | ``REQ``                            |
| TYPE_ID               | crm_status   | Тип компании                                                                                         | Код справочника: `DEAL_TYPE`       |
| CATEGORY_ID           | crm_category | Направление сделки                                                                                   |                                    |
| STAGE_ID              | crm_status   | Стадия                                                                                               | Код справочника: `DEAL_STAGE`      |
| STAGE_SEMANTIC_ID     | char         | Семантическая стадия                                                                                 | ``RO``                             |
| IS_NEW                | char         | Сделка только что создана                                                                            | ``RO``                             |
| IS_RECURRING          | char         | Флаг регулярности                                                                                    | Y/N                                |
| IS_RETURN_CUSTOMER    | char         | Сделка от существующего клиента                                                                      | Y/N                                |
| IS_REPEATED_APPROACH  | char         | Сделка для повторного обращения                                                                      | Y/N                                |
| PROBABILITY           | int          | Вероятность                                                                                          |                                    |
| CURRENCY_ID           | crm_currency | Валюта                                                                                               |                                    |
| OPPORTUNITY           | double       | Сумма                                                                                                |                                    |
| IS_MANUAL_OPPORTUNITY | char         | Флаг, означающий что сумма сделки установлена вручную, а не рассчитана на основании товарных позиций | Y/N                                |
| TAX_VALUE             | double       | Ставка налога                                                                                        |                                    |
| EXCH_RATE             | double       | Курс конвертации                                                                                     | ``RO``                             |
| ACCOUNT_CURRENCY_ID   | string       | Валюта для отчетов                                                                                   | ``RO``                             |
| OPPORTUNITY_ACCOUNT   | double       | Сумма для отчетов                                                                                    | ``RO``                             |
| TAX_VALUE_ACCOUNT     | double       | Налог для отчетов                                                                                    | ``RO``                             |
| COMPANY_ID            | crm_company  | Компания                                                                                             |                                    |
| CONTACT_ID            | crm_contact  | Контакт                                                                                              | ``DEP``, используйте `CONTACT_IDS` |
| CONTACT_IDS           | crm_contact  | Контакты                                                                                             | ``MUL``                            |
| QUOTE_ID              | crm_quote    | Ком.пред                                                                                             | ``RO``                             |
| BEGINDATE             | date         | Дата начала                                                                                          |                                    |
| CLOSEDATE             | date         | Дата окончания                                                                                       |                                    |
| OPENED                | char         | Доступна для всех                                                                                    | Y/N                                |
| CLOSED                | char         | Сделка закрыта                                                                                       | Y/N                                |
| COMMENTS              | string       | Комментарий                                                                                          |                                    |
| ASSIGNED_BY_ID        | user         | Ответственный                                                                                        |                                    |
| CREATED_BY_ID         | user         | Кем создана                                                                                          | ``RO``                             |
| MODIFY_BY_ID          | user         | Кем изменена                                                                                         | ``RO``                             |
| DATE_CREATE           | datetime     | Дата создания                                                                                        | ``RO``                             |
| DATE_MODIFY           | datetime     | Дата изменения                                                                                       | ``RO``                             |
| SOURCE_ID             | crm_status   | Стадия                                                                                               | Код справочника: `SOURCE`          |
| SOURCE_DESCRIPTION    | string       | Примечание к источнику                                                                               |                                    |
| LEAD_ID               | crm_lead     | Лид                                                                                                  | ``RO``                             |
| ADDITIONAL_INFO       | string       | Дополнительная информация                                                                            |                                    |
| LOCATION_ID           | location     | Местоположение                                                                                       |                                    |
| ORIGINATOR_ID         | string       | Внешний источник                                                                                     |                                    |
| ORIGIN_ID             | string       | Идентификатор элемента во внешнем источнике                                                          |                                    |
| UTM_SOURCE            | string       | Рекламная система                                                                                    |                                    |
| UTM_MEDIUM            | string       | Тип трафика                                                                                          |                                    |
| UTM_CAMPAIGN          | string       | Обозначение рекламной кампании                                                                       |                                    |
| UTM_CONTENT           | string       | Содержание кампании                                                                                  |                                    |
| UTM_TERM              | string       | Условие поиска кампании                                                                              |                                    |


Примечание к перечисленным полям: 
1. Для расшифровки типов можно обратиться к [Типам данных](../01_Словари/20_Типы_данных).
    
2. Для обозначения специальных полей используются дополнительные флаги:
* ``RO`` - read only (поле только для чтения)
* ``AI`` - auto increment (автоматически заполняемый счетчик, наследует поведение ``RO``)
* ``REQ`` - required (обязательное)
* ``DEP`` - deprecated (устаревшее). Не следует ориентироваться на данные поля, так как они могут быть удалены или их поведение было изменено
* ``MUL`` - множественное поле (привязки через внешние таблицы)
* ``HID`` - недоступное для просмотра поле, рассчитываемое автоматически

3. Не следует использовать поля `ORIGINATOR_ID` и `ORIGIN_ID` для хранения внешних ключей при синхронизации. Эти поля заполняются исключительно при создании из внешних систем и не должны изменяться при обновлении.



Только что созданная сделка (где не выполнялось никаких обновлений) будет помечена флагом `Y` в поле `IS_NEW`, после первого изменения он будет изменен на `N`.
Если сделка привязана к лиду от существующего клиента (т.е. лид помечен от повторного обращения) и при этом она не привязана к контакту или компании, то она будет помечена флагом `Y` в поле `IS_REPEATED_APPROACH` что означает что сделка является повторным обращением.
Если к сделке привязан хоть один контакт или компания и при этом у них существует хоть одна успешная сделка, то сделка будет помечена как флагом `Y` в поле `IS_RETURN_CUSTOMER`, что означает повторная продажа.
При этом флаги `IS_REPEATED_APPROACH` и `IS_RETURN_CUSTOMER` являются взаимоисключающими.
При этом при определении по уровню контакта и компании имеется строгий приоритет: Компания -> Контакт. Это означает что при проверке сделки если указана компания то определение сделок по контакту будут игнорироваться. Например: при создании сделки с контактом Х и компанией У проверки будет проводиться только по завершенным сделкам компании У, без проверки на завершенные сделки контакта Х.
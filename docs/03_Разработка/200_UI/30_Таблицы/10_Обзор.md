# Обзор компонента

[TOC]

Системный компонент `bitrix:main.ui.grid` обеспечивает отображение табличного представления данных на странице и отвечает за работу вспомогательных возможностей (изменения порядка и отображения столбцов, обработку панель действий и других).
Для более углубленного изучения, его можно найти в директории `bitrix/components/bitrix/main.ui.grid/` вашего проекта.

Немного терминологии:
- Грид - табличное представление отображаемое на странице
- Бургер (кнопка действия, actions) - контекстное меню строки, позволяющее выполнять различные действия
- Пресет - персональные настройки пользователя, отвечающие за отображение грида (порядок столбцов, их ширина)

## Параметры компонента

Обязательные параметры компонента:

| Параметр | Описание |
| :------- | -------- |
| `GRID_ID` (string) | Идентификатор грида |
| `HEADERS` / `COLUMNS` (array) | Набор мета-описаний столбцов. Подробнее в главе Описание столбцов |

Параметры компонента, отвечающие за данные:

| Параметр | Описание |
| :------- | -------- |
| `ROWS` (array) | Набор данных для отображения строк. Подробнее в главе Строки |
| `TOTAL_ROWS_COUNT` (int) | Число, которое используется для отображения общего количества записей. См. примечание для поля `FOOTER` |
| `AJAX_ID` (string) | Уникальный идентификатор грида. Обычно генерируется через код `\CAjax::GetComponentID('bitrix:main.ui.grid', '', '')` |
| `NAV_PARAM_NAME` (string) | Символьный код параметра, отвечающего за наличие в url номера страницы для постраничной навигации |
| `CURRENT_PAGE` (int) | Номер текущей страницы (используется для постраничной навигации) |
| `NAV_STRING` (string) | HTML фрагмент, отрисованной постраничной навигации. Один из параметров, который может быть передан в комплексном поле `FOOTER` (см. примечание этого поля) или вычислен на основании параметров навигации (см. параметры навигации) |
| `ACTIONS_LIST` (array) | Набор действий, доступных для отображения в гриде. Подробнее в главе Панель действий |
| `PAGE_SIZES` (array) | Набор значений, используемых для вывода допустимых размеров постраничной навигации. Состоит из структур вида: `['NAME' => "5", 'VALUE' => '5'],`|
| `DEFAULT_PAGE_SIZE` (int) | Количество строк, отображаемых на странице. По-умолчанию: 20 |
| `ALLOW_INLINE_EDIT` (bool) | Разрешить редактирование на странице. Алиас для значения `EDITABLE` |
| `SHOW_ROW_ACTIONS_MENU` (bool) | Отображать кнопку действия над строками. Алиас для значения `ROW_ACTIONS`|
| `SHOW_ROW_CHECKBOXES` (bool) | Отображать чек-боксы для строк |
| `SHOW_NAVIGATION_PANEL` (bool) | Отображать навигационную панель |
| `ALLOW_GROUP_ACTIONS` (bool) | Отображать панель групповых действий. Алиас для `ACTION_ALL_ROWS` |
| `SHOW_CHECK_ALL_CHECKBOXES` (bool) | Отображать чек-бокс для выбор всех элементов |
| `ALLOW_CONTEXT_MENU` (bool) | Включить поведение отображения контекстного меню для строки, по клику правой кнопкой мышки |
| `SHOW_GRID_SETTINGS_MENU` (bool) | Отображать шестеренку с возможностью конфигурировать грид |
| `SHOW_MORE_BUTTON` (bool) | Отображать кнопку "Загрузить еще" |
| `SHOW_PAGINATION` (bool) | Отображать постраничную навигацию |
| `SHOW_PAGESIZE` (bool) | Отображать переключатель количества строк на странице |
| `SHOW_SELECTED_COUNTER` (bool) | Отображать количество выделенных элементов на странице |
| `SHOW_TOTAL_COUNTER` (bool) | Отображать количество элементов на странице |
| `TOTAL_ROWS_COUNT_HTML` (string) | HTML для отображения количества элементов. Подробнее в главе "Количество строк" |
| `ALLOW_COLUMNS_SORT` (bool) | Разрешить менять столбцы местами |
| `ALLOW_ROWS_SORT` (bool) | Разрешить менять местами строки. Подробнее в главе "Порядок строк"|
| `ALLOW_ROWS_SORT_IN_EDIT_MODE` (bool) | Разрешить менять местами строки в режиме редактирования. Подробнее в главе "Порядок строк"|
| `ALLOW_ROWS_SORT_INSTANT_SAVE` (bool) | Немедленное сохранение при изменении порядка. Подробнее в главе "Порядок строк"|
| `ALLOW_HORIZONTAL_SCROLL` (bool) | Разрешить горизонтальную прокрутку таблицы |
| `ALLOW_SORT` (bool) | Разрешить пользователям изменять сортировку данных по тем столбцам, которые разрешены для изменения сортировки. Персональная настройка.  |
| `ALLOW_COLUMNS_RESIZE` (bool) | Разрешить пользователям изменять ширину столбцов, для тех столбцов у которых резрешено растягивание. Персональная настройка. Алиас для `ALLOW_COLUMN_RESIZE`|
| `COLS_RESIZE_META` (array) | Структура описывающая ширину строк |
| `SHOW_ACTION_PANEL` (bool) | Нужно ли отображать панель действий |
| `ENABLE_COLLAPSIBLE_ROWS` (bool) | Разрешить сворачивание (схлопывание) строк. Подробнее в главе Сворачивание строк |
| `ROW_LAYOUT` (array) | Шаблон строки. Подробнее в главе Шаблон строки |
| `TOP_ACTION_PANEL_RENDER_TO` (string) | Идентификат DOM-элемента, куда будет осущствляться отрисовка панели действий |
| `TOP_ACTION_PANEL_PINNED_MODE` (bool) | В случае `true` прикрепляет панель действий к ноде |
| `ADVANCED_EDIT_MODE` (bool) | Один из флагов отвечающий за возможность редактировать строки. Либо должен быть установлен флаг, либо в списке должен присутствовать хотя бы одна строка с признаком редактируемой. |
| `ALLOW_EDIT_SELECTION` (bool) | Если установлен, добавляет чек-боксы к строкам и разрешает выбирать строки |
| `SETTINGS_WINDOW_TITLE` (string) | Строка, отвечающая за название попапа формы настроек |
| `HIDE_TOP_BORDER_RADIUS` (bool) | Если установлен, скрывает округление верхней части таблицы|
| `HIDE_BOTTOM_BORDER_RADIUS` (bool) | Если установлен, скрывает округление нижней части таблицы |
| `ACTIONS` (array) | Набор действий, который на момент описания включает в себя структуру вида `["list" => <data>]`, где `<data>` - содержимое `ACTIONS_LIST`|
| `FOOTER` (array) | Опциональный параметр, который используется для логической группировки параметров `TOTAL_ROWS_COUNT` и `NAV_STRING`. Это значит, что указанные параметры можно передавать как явно в параметрах компонента, так и через массив используя ключ `FOOTER` |

>Не обязательно указывать все ключи, многие из них имеют поведения по-умолчанию или перекрываются другими комбинациями ключей


### Описание столбцов

Описание столбцов можно передавать любым из указанных ключей: `HEADERS` или `COLUMNS`. На текущий момент ключ `HEADERS` является устаревшим и используется в гридах как наследие.

Минимальный набор полей для описания столбцов грида:

| Параметр | Описание |
| :------- | -------- |
| `id`      (string) | Уникальный идентификатор строки |
| `name`    (string) | Отображаемое название столбца |
| `sort`    (string) | Код, который будет использоваться для сортировки по столбцу |
| `default` (bool)   | Флаг, указывающий, если поле нужно выводить по-умолчанию |

Дополнительные параметры, которые так же могут быть полезны к использованию:

| Параметр | Описание |
| :------- | -------- |
| `align` (string)  | Выравнивание содержимого столбцов. Допустимы `center`, `left`, `right`|
| `showname` (char) | В случае если значение `N` - название столбца не будет отображаться |
| `class` (string)  | Строка с дополнительными css-классами |
| `width` (int)     | Ширина столбца в пикселях |
| `editable` (bool) | Разрешено ли редактировать строчку |
| `prevent_default` (bool) | Если флаг передан и он `false`, то грид не будет завершать действия по-умолчанию |
| `sticked` (bool) | Если передан флаг, то столбец фикисруется, "прилипает" к месту |


### Параметры навигации

Существует несколько способов отобразить стандартную постраничную навигацию:
1. Передача строки с отрисованной постраничной навигацией через параметр компонента `NAV_STRING`
2. Передача объекта `NAV_OBJECT` (наследника `\Bitrix\Main\UI\PageNavigation`)
3. Передача объекта `NAV_OBJECT` (наследника `CDBResult`). Навигация будет осуществляться через метод `GetPageNavStringEx` с учетом параметров компонента из `~NAV_PARAMS`

Дополнительно существует возможность использовать "ленивую подгрузку" - на страницу загружается лишь то количество элементов, которое нужно при первоначальной орисовке.
Затем, в случае наличия следующих страниц, отрисовывается кнопка для подгрузки следующих. Для работы необходимо передавать следующие параметры компонента:

- `SHOW_MORE_BUTTON` (bool) - `true`, в случае, если хотите использовать кнопку ленивой подгрузки
- `ENABLE_NEXT_PAGE` (bool) - `true`, в случае если присутствуют другие страницы
- `NAV_PARAM_NAME` (string) - название параметра, используемого для хранения номера страницы
- `CURRENT_PAGE` (int) - номер текущей страницы

>Ленивая подгрузка не отменяет действия постраничной навигации - их можно использовать одновременно

### Панель действий

>В процессе написания

### Количество строк

В случае отображения панели (`SHOW_NAVIGATION_PANEL` = `true`) есть несколько возможностей отобразить количество существующих записей (`SHOW_TOTAL_COUNTER` = `true`).
Причем сделать это можно двумя способами.

С одной стороны, можно указать параметр `TOTAL_ROWS_COUNT` - число, которое будет отображаться как количество записей.
Но не всегда есть возможность посчитать количество элементов, доступных по фильтру и отобразить - иногда эта операция является трудозатратной.

Для рализации ленивой подгрузки данных, можно воспользоваться произвольным HTML-кодом, который бы в фоновом режиме опрашивал источник и подсчитывал значения или делал это по требованию пользователя.

Такой html можно установить через параметр компонента - `TOTAL_ROWS_COUNT_HTML`.

### Порядок строк

>В процессе написания

### Сворачивание строк

>В процессе написания

### Плитка

>В процессе написания

### Шаблон строки

>В процессе написания

```
if (is_array($this->arParams["ROW_LAYOUT"]) && !empty($this->arParams["ROW_LAYOUT"]))
{
	$this->arParams["ALLOW_COLUMNS_SORT"] = false;
	$this->arParams["ALLOW_SORT"] = false;
}
```
### Предустановленный формат

>В процессе написания

```php
В системе предусмотрен формат технической строки

private function prepareTemplateRow(): void
{
	$templateRow = [
		'id' => 'template_0',
		'not_count' => true,
		'attrs' => [
			'hidden' => 'true',
		],
	];

	foreach ($this->arParams['ROWS'] as $key => $row)
	{
		if (isset($row['id']) && $row['id'] === 'template_0')
		{
			$templateRow = array_merge($row, $templateRow);
			unset($this->arParams['ROWS'][$key]);
			break;
		}
	}

	array_unshift($this->arParams['ROWS'], $templateRow);
}
```